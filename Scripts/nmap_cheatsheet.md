### Syn Scan (requires priviledged user) allows to scan without completing the TCP 3-way handshake, sending a `RST` packet after the `SYN, ACK` packet from the server. Tearing down the connection to be more stealthy and decreasing the chances of the scan being logged.

```bash
nmap -sS
```

### UDP Scan - Being a connectionless protocol, it does not require any handshake to establish a connection. if a port is open, we won't get any reply. The ones that are closed will reply back with an ICMP packet type 3 `destination unreachable` and port 3 `port unreachable`. The ports that don't generate any response are the ones that Nmap will state as open.

```bash
nmap -sU
```

### OS detection

```bash
nmap -O
```

### Services running

```bash
nmap -sV
```

### Verbose

```bash
nmap -V
```

### Verbose level 2

```bash
nmap -vV
```

### save result in 3 major formats

```bash
nmap -oA
```

### Output scan in normal, XML, s|<rIpt kIddi3, and Grepable format


-oN <file>
-oX <file>
-oS <file>
-oG <file> 

### Aggressive mode (activate service detection, OS detection, script scanning and traceroute)

```bash  
nmap -A
```
  
### Scan speed (paranoid, sneaky, polite, normal, aggressive, insane). To avoid IDS alerts, you might consider `-T0` or `-T1`. `-T0` scans one port at a time and waits 5 minutes between sending each probe. If you don't specify any timing, Nmap will use default `-T3`. `-T5` is the most aggresive in terms of speed, but can affect accuracy.
 
```bash  
nmap -T1-5
```

  
## Control packet rate with `--min-rate <number>` and `--max-rate <number>`.
  

## Control number of probes in parallel with `--min-parallelism <number>` and `--max-parallelism <number>`.
  
  
### Scan specific port(s)

```bash
nmap -p <port>
```
  
### Scan port range

ex:

```bash
nmap -p 1000-1500
```
  
### scan all ports

```bash
nmap -p-
```
  
### Activate scripts

```bash  
nmap --script <script>
```
### Active all scripts in the Vuln category

```bash  
nmap --script=vuln
```
  
### Command to identify all ip addresses of a network and save the output to a file.

```bash
nmap -sn 0.0.0.0/24 | awk '/Nmap scan/{gsub(/[()]/,"",$NF); print $NF > "nmap_scanned_ips"}'
```

  
### Get detailed list of hosts that Nmap will scan without scanning them

```bash  
nmap -sL <ip address>
```


### Using `ICMP Echo` request to discover live hosts (added -sn to not follow with port scan). If you get MAC addresses in the echo replies, it means that the hosts are on the same subnet.
  
```bash
nmap -PE -sn machine_ip/24
```
  
### If firewall is blocking `ICMP Type 8 Echo` requests, we can try 2 different scans, `ICMP Timestamp` or `ICMP Address Mask` requests to tell if a system is online:
  

ICMP Timestamp:
  
```bash
nmap -PP -sn machine_ip/24
```
  
ICMP Address Mask requests:

```bash
nmap -PM -sn machine_ip/24
```
  
Since we don't know which ICMP packet is blocked by the host firewall, it's important to try different scans in order to properly map the target network.
 

## TCP SYN Ping
  
### Send packet with `SYN` flag set to a TCP port (by default 80). Open port returns `SYN/ACK`, closed port `RST`.
  
**Nmap using TCP SYN ping**:
  
```bash
nmap -PS -sn machine_ip/24
```
  
To scan for one specific port (below, port 21):
  
```bash
nmap -PS21 -sn machine_ip/24
```
  
Port range (below, ports 21,22,23,24,25):
  
```bash
nmap -PS21-25 -sn machine_ip/24
```

Several specific ports:
  
```bash
namp -PS80,443,8000 -sn machine_ip/24
```

Scan all ports (all 65535) use `-p-`
  
When running these commands as `root` or as a `sudoer`, you can send TCP SYN packets and don't need to complete the TCP 3-way handshake even if the port(s) is/are open. Unpriviledge users must complete the handshake if a port is open.
  

## TCP ACK Ping
  
  
This option sends a packet with an ACK flag set. You must be running Nmap as a priviledge user to do it. If running it as an unpriviledged user, Nmap will attempt a 3-way handshake.
  
The following command allows you to send a packet with an `ACK flag` set. As with the `SYN` packet, you can specify a port, a port range or several specific ports. 
By default, if not port(s) is specified, port `80` is used. The expected reply from the host, if it is up, is a `RST` flag. The target responds with a `RST` flag because the TCP packet with the `ACK` flag is not part of an ongoing connection (no previous TCP 3-way handshake completed prior to sending the packet). Receiving the `RST` flag is the intended reply and is used to detect if the host is up.
  
Command:
  
```bash
sudo nmap -PA -sn machine_ip/24
```
  

## UDP Ping
  
  
`UDP` ping can be used to discover online hosts. When sending a `UDP` packet to an open port, no reply is expected. However, sending a `UDP` packet to a closed port will result in an `ICMP port unreachable` packet, meaning the host is up and running.
  
```bash
nmap -PU -sn machine_ip/24
```

  
You can also set a specific port, a port range or several specific ports to scan (see `TCP SYN Ping` section above for syntax).
  

## Using Reverse-DNS Lookup
  


Nmap’s default behaviour is to use reverse-DNS online hosts. Because the hostnames can reveal a lot, this can be a helpful step. However, if you don’t want to send such DNS queries, you use `-n` to skip this step.

By default, Nmap will look up online hosts; however, you can use the option `-R` to query the DNS server even for offline hosts. If you want to use a specific DNS server, you can add the `--dns-servers DNS_SERVER` option.
  
  
ARP Scan:
  
```bash
sudo nmap -PR -sn MACHINE_IP/24
```

Quick host dicovery flag recap:
  
`-n`: No DNS lookup

`-R`: reverse-DNS lookup for all hosts
  
`-sn`: host discovery only
  

## Confirm TCP port is open w/o establishing a TCP connection 

(you need to be a priviledged user, reply with `RST, ACK` flag means closed port):
  
```bash
nmap -sT machine_ip
```
  
## Fast Mode 
  
Scanning only the top 100 ports:
  
```bash
nmap -sT -F machine_ip
```
  
## The `-r` option can be added to scan ports in consecutive order instead of random.
  
## Null Scan
  
No Flags are set, a TCP packet with no flags set will not trigger any response when it reaches an open port. Therefore, from Nmap’s perspective, a lack of reply in a null scan indicates that either the port is open or a firewall is blocking the packet. We get a `RST` packet if the port is closed. We can use the lack of `RST` response to figure out which ports are open or filtered.
  
```bash
nmap -sN machine_ip
```
  
## FIN Scan
  
Sends a TCP packet with the `FIN` flag set. No response will be sent if the TCP port is open/filtered.
  
```bash
nmap -sF machine_ip
```
  
## Xmas Scan
  
Sends the `FIN`, `PSH` and `URG` flags simultaneously. If a `RST` packet is received, it means that the port is closed, otherwise it will be displayed as open/filtered.
  
```bash
nmap -sX machine_ip
```
 
## TCP Maimon Scan
  
Uriel Maimon first described this scan in 1996. In this scan, the FIN and ACK bits are set. The target should send an RST packet as a response. However, certain BSD-derived systems drop the packet if it is an open port exposing the open ports
  
```bash
nmap -sM machine_ip
```
  
## `ACK` Scan
  
Useful to discover if ports are behind firewall rules. THe scan sends packet with the `ACK` flag, resulting in the target replying with a `RST` flag packet. It won't tell us if ports or open or closed, but it will display ports that are not filtered/filtered, therefore useful to discover firewall rule sets and configuration.
  
```bash
namp -sA machine_ip
```
  




