## Command Injection Exploit

For this vulnerability assessment we are going to use a DVWA instance, the "Damn Vulnerable Web Application".


Command used to display “/etc/passwd”:

```bash
8.8.8.8 && ls; cat ../../../../../etc/passwd
```


Result:

![dvwa command injection](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/etc_passwd_command_injection_successful.png)


Command to display “/etc/hosts”

```bash
8.8.8.8 && ls; cat ../../../../../etc/hosts
```

![dvwa command injection](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/etc_hosts_command_injection_successful.png)

#### Mitigation:

There are several practices that can be implemented to prevent command injections, below a few of them:

- Set up input validation, where arguments with “;”, “&&”, “|” and “..” or “../” are banned.
- Create a white list of possible inputs to make sure that the system will accept only predefined inputs. For example, if an input field requires users to type in a day of the   week, only the 7 days of the week can be accepted as an input for this specific field.
- Use only secure APIs. For example with Java, instead of using Runtime.exec() to issue a mail command, it’s safer to use the available API located at javax.mail. Instead of     running a process that has the power to control many more processes and can be leveraged to run other commands than what it was intended for in the first place, an API will    have a narrower function, and will be called to accomplish a certain task tied to a microservice most of the time.


## Brute Force Attack

In this assessment I will use Burp Suite and more specifically the "Intruder" feature. I will use the bWAPP open source insecure web application.

The goal of this pentest is to show you how in a few steps, with an open source tool and a list of username & password, anybody can launch a successful brute force attack (especially without 2FA enabled) to gain access to a web application portal. 

### Intercepting Web Requests in Burp Suite 

We will use Burp Suite to intercept a login web request, analyze the request and design a payload that will be launched by Burp Suite to brute force access to the web portal.

Below is how I did it.

First, I installed the Foxy Proxy web browser extension (you can easily find guide online to download and use the extension). This extension allows me to setup a proxy via Burp Suite so that all web requests are intercepted in Burp Suite before being actually sent to the server.

Next I launched the bWAPP locally on my lab machine and opened the insecure login web page (192.168.13.35/ba_insecure_login_1.php). This page is an admin web application login page. When you use the correct credentials to login, it will return a "Successful" message and if the credentials are incorrect it will return "Invalid credentials".


For this demonstration, I will use an existing list of usernames & passwords to show you how we can use Burp Suite to automatically brute force access to the web application.

I begin by turning on Foxy Proxy and entering wrong credentials so that I can send a request and have it intercepted in Burp Suite for analysis:

![bWAPP brute force](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/login_capture_web_request_w_burpsuite.png)


Next, I analyzed the request in the “Intercept” section of Burp Suite:


![bWAPP brute force](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/burpsuite_intercept.png)


Next, I set up the payload by selecting the Username (login) and password fields by highlighting the placeholders that the “Intruder” module will use to brute force the access:


![bWAPP brute force](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/burpsuite_settingUP_payload.png)


Next, I set up the 2 payload sets. "Set 1" is the Username list we will use in the “Login” section of the page. "Set 2" is the password list that will be used in the “password” section of the web page:


![bWAPP brute force](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/payload_set_1.png)


![bWAPP brute force](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/payload_set_2.png)


A few minutes later, I was able to identify the vulnerable account. 99/100 requests were unsuccessful, but one was a success and I was able to login. 

By looking at the HTTP response I was able to quickly check if I was successful or not, indeed, all failed requests have an HTTP response length of “11801” but one request was slightly longer at “11827”, representing the successful one: Login: `tonystark` | Password: `I am Iron Man`


Below, I highlighted a failed request to login. As you can see the payload 1 is the username and the paylod 2 is the password that was automatically used by the Intruder module of Burp Suite to perform the brute force attack. In the bottom part of the screenshot you can see a render of the web page with the result of the request and, as we can see, the credentials did not work and "invalid credentials!" was displayed. 


![bWAPP brute force](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/bWAPP_unsuccessful_exploit.png)


Now, when paying close attention to the length of the response, i.e., 11801, I noticed that all failed requests have the same length (see above screenshot).

Next, scrolling through the failed attempts at login, I noticed one response with a slightly longer length, i.e., 11827. I then clicked on the render tab and noticed that the credentials used by Burp Suite worked and the username/password combo that allowed me access to the wep application was `tonystark` / `I am Iron Man` (screenshot below):

![bWAPP brute force](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/bWAPP_successful_exploit.png)


#### Mitigation:

There are a few best practices and technical control that we can set up:

- Requiring long, passphrase-type passwords that will render close to impossible to brute force.
- Requiring the use of 2FA (Two Factor Authentication or Multi-Factor Authentication).
- Setting up an automatic lockout after a certain number of failed attempts have been made against an account.




